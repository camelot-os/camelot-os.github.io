<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Runing kernel autotests - Camelot Operating System</title><meta name="description" content="About kernel autotests Camelot-OS Sentry kernel hold a complete test suite that is made to check all the kernel application interface and also verify some kernel behaviours (such as capability usage or performances). The autotest test suite is implemented in the kernel sources autotest subdir,&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="stylesheet" href="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-beige.css"><link rel="stylesheet" href="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://camelot-os.h2lab.org/runing-kernel-autotests/"><link rel="alternate" type="application/atom+xml" href="https://camelot-os.h2lab.org/feed.xml" title="Camelot Operating System - RSS"><link rel="alternate" type="application/json" href="https://camelot-os.h2lab.org/feed.json" title="Camelot Operating System - JSON"><meta property="og:title" content="Runing kernel autotests"><meta property="og:image" content="https://camelot-os.h2lab.org/media/website/camelot-OS.png"><meta property="og:image:width" content="323"><meta property="og:image:height" content="342"><meta property="og:site_name" content="Camelot Operating System"><meta property="og:description" content="About kernel autotests Camelot-OS Sentry kernel hold a complete test suite that is made to check all the kernel application interface and also verify some kernel behaviours (such as capability usage or performances). The autotest test suite is implemented in the kernel sources autotest subdir,&hellip;"><meta property="og:url" content="https://camelot-os.h2lab.org/runing-kernel-autotests/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://camelot-os.h2lab.org/media/website/h2lab.png" type="image/png"><link rel="stylesheet" href="https://camelot-os.h2lab.org/assets/css/style.css?v=1d12dfc293a797122c81fcead8a9b6ac"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://camelot-os.h2lab.org/runing-kernel-autotests/"},"headline":"Runing kernel autotests","datePublished":"2026-01-19T09:28+01:00","dateModified":"2026-01-19T11:42+01:00","image":{"@type":"ImageObject","url":"https://camelot-os.h2lab.org/media/website/camelot-OS.png","height":342,"width":323},"description":"About kernel autotests Camelot-OS Sentry kernel hold a complete test suite that is made to check all the kernel application interface and also verify some kernel behaviours (such as capability usage or performances). The autotest test suite is implemented in the kernel sources autotest subdir,&hellip;","author":{"@type":"Person","name":"H2Lab Development Team","url":"https://camelot-os.h2lab.org/authors/h2lab-development-team/"},"publisher":{"@type":"Organization","name":"H2Lab Development Team","logo":{"@type":"ImageObject","url":"https://camelot-os.h2lab.org/media/website/camelot-OS.png","height":342,"width":323}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.ti{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style><style>:root {--toc-max-height: auto;}html {scroll-padding-top: 2rem;}.post__toc h2{align-items: center;border: none;cursor: pointer;display: inline-flex;gap: .5em;margin: 0;padding: 0;user-select: none;}.post__toc > ol {margin-left: 0;max-height: 0;overflow: auto;opacity: 0;transition: opacity 0.3s ease-out, max-height 0.5s ease-out;}.post__toc > ol[aria-hidden="false"] {max-height: var(--toc-max-height);opacity: 1;transition: opacity 0.3s ease-in, max-height 0.5s ease-in;}.post__toc ol {counter-reset: item;list-style: none;}.post__toc li {padding-left: 0;padding-bottom: 0;}.post__toc ol ol {margin-left: 1.5rem;margin-top: 0;}.post__toc ol ol li::before {margin-left: 0;}.post__toc a {align-items: stretch;color: var(--toc-link-color, var(--link-color));display: inline-flex;flex-wrap: nowrap;}.post__toc a:hover, .post__toc a:active, .post__toc a:focus {color: var(--toc-link-color-hover, var(--link-color-hover));}.post__toc a::before {content: counters(item, ".", none) ". ";counter-increment: item;color: var(--toc-number-color, var(--text-color));display: inline-block;flex-grow: 0;flex-shrink: 0;margin-right: 0.2em;}.post__toc-toggle {background: none;border: none;border-radius: 0;box-shadow: none;color: var(--toc-toggle-link-color, var(--color));cursor: pointer;display: inline;font-weight: normal;overflow: visible;padding: 0;text-align: left;text-decoration: none;text-transform: none;vertical-align: baseline;will-change: unset;}.post__toc-toggle:hover, .post__toc-toggle:active, .post__toc-toggle:focus {background: inherit;border: inherit;box-shadow: inherit;color: var(--toc-toggle-link-color-hover, var(--color, inherit));text-decoration: none;transform: inherit;}.post__toc-toggle::before{content: "[";color: var(--toc-toggle-color, var(--text-color));}.post__toc-toggle::after {content: "]";color: var(--toc-toggle-color, var(--text-color));}</style><noscript><style>.post__toc > ol {max-height: var(--toc-max-height);opacity: 1;transition: none;}.post__toc h2{cursor: default;}</style></noscript></head><body class="page-template"><header class="top js-header"><a class="logo" href="https://camelot-os.h2lab.org/"><img src="https://camelot-os.h2lab.org/media/website/camelot-OS.png" alt="Camelot Operating System" width="323" height="342"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Pages</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://camelot-os.h2lab.org/camelot-os-because-secure-systems-deserve-a-secure-foundation/" target="_self">Introduction</a></li><li><a href="https://camelot-os.h2lab.org/sentry-micro-kernel/" target="_self">Sentry micro-kernel</a></li><li><a href="https://camelot-os.h2lab.org/camelot-os-sdk/" target="_self">Camelot SDK</a></li></ul></li><li><a href="https://camelot-os.h2lab.org/" target="_self">Blog Posts</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Documentation</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://sentry-kernel.readthedocs.io/en/latest/" target="_blank">Sentry kernel</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Howtos</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active"><a href="https://camelot-os.h2lab.org/runing-kernel-autotests/" target="_self">Autotesting Sentry kernel</a></li><li><a href="https://camelot-os.h2lab.org/how-to-create-a-camelot-os-project/" target="_self">Run a Camelot-OS project</a></li><li><a href="https://camelot-os.h2lab.org/bootstrap-a-rust-application/" target="_self">Bootsrap your Rust application</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Repositories</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://github.com/camelot-os/sentry-kernel" target="_blank">Sentry Kernel</a></li><li><a href="https://github.com/camelot-os/shield" target="_self">Shield runtime</a></li><li><a href="https://github.com/camelot-os/shield" target="_self">Barbican project manager</a></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="wrapper search__overlay-inner"></div></div><button class="search__btn btn--icon js-search-btn" aria-label="Search"><svg height="18" width="18" role="presentation" focusable="false"><use xlink:href="https://camelot-os.h2lab.org/assets/svg/svg-map.svg#search"/></svg></button></div></header><main class="page"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>Runing kernel autotests</h1></div></header></div><div class="entry-wrapper content__entry"><h2 data-start="335" data-end="391"></h2><h2 data-start="335" data-end="391">About kernel autotests</h2><p>Camelot-OS Sentry kernel hold a complete test suite that is made to check all the kernel application interface and also verify some kernel behaviours (such as capability usage or performances).</p><p>The autotest test suite is implemented in the kernel sources <code>autotest</code> subdir, and is written in both <strong>C </strong>and <strong>Rust</strong>, so that it can validate both usages of the kernel userspace programmative interface.</p><p>Sentry kernel in autotest mode is not made to include third-party applications but instead is seen as a standalone firmware build that allows runtime checks. See <a href="https://sentry-kernel.readthedocs.io/en/latest/tests/autotest.html">autotest</a> chapter of the Sentry kernel documentation for more informations.</p><h2 data-start="335" data-end="391">Setting Up the Sentry Kernel Build Environment</h2><h3 data-start="393" data-end="422">Install Required Tools</h3><p data-start="424" data-end="498">First, clone the Sentry kernel repository and install Python dependencies:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"> </div><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><pre class="language-bash"><code>git clone https://github.com/camelot-os/sentry-kernel.git
cd sentry-kernel
pip3 install -r requirements.txt</code></pre></div></div><p data-start="619" data-end="748">This installs the Meson build system and other helpers needed to configure and build Sentry.</p><p data-start="619" data-end="748">In order to compile the kernel, you also need toolchains. One gcc cross-toolchain that you can download, for example, on the <a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">official ARM</a> repository. Note that for cortex-m or cortex-r 32 bits architectures in bare metal mode, you need the <code>arm-none-eabi</code> targetting toolchain.</p><p data-start="619" data-end="748">Because Sentry-kernel is using Rust for the user API library, you also need a rust toolchain. See the rustup <a href="https://rust-lang.github.io/rustup/cross-compilation.html">cross-toolchain</a> page for more information on how to install the corresponding toolchain.</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><p>Be sure to have the <code>srecord</code> (that delivers the <code>srec_cat</code> command) tool installed, as it is required to generate the Intel hex file from the various ELF files generated for each component.</p></div></div><h2 data-start="1817" data-end="1842"></h2><h2 data-start="755" data-end="791">Configure for Autotest Mode</h2><p data-start="793" data-end="952">Sentry uses the <strong data-start="809" data-end="818">Meson</strong> build system. To compile your kernel in <em data-start="859" data-end="874">autotest mode</em> (which enables integration tests and special autotest firmware), you need to:</p><h3 data-start="954" data-end="979">Select the kernel configuration</h3><h4>Defconfig file</h4><p>Sentry-kernel (and all Camelot-OS) uses Kconfig for its configuration, in the same way projects such as Linux kernel or Grub do for their configuration step.</p><p>There are some sample defconfig files in the kernel config directory that configure the kernel in autotest mode. Select the file you need based on the board you wish to validate Sentry kernel against.</p><div> </div><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary">Defconfig files are made to be configured with the defconfig utility you installed through the python requirements:</div><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><pre class="language-bash"><code>defconfig configs/stm32f429i_disc1_autotest_defconfig</code></pre></div></div><p data-start="1130" data-end="1233">This defconfig enables the autotest support for your chosen board,  and generate the <code>.config</code> file in the directory where you launched the defconfig command.</p><h4 data-start="1130" data-end="1233">Device-tree file</h4><p data-start="1268" data-end="1306">Alongside the config file, Sentry also delivers custom device-tree files made for autotest, for various boards. Be sure to be homogeneous between the defconfig and device-tree file. The device-tree file is made to define the devices that will be used and the memory areas that are distributed among all applications, including the kernel.</p><p data-start="1268" data-end="1306">In autotest mode, the firmware only hold two applications, being:</p><ul><li data-start="1268" data-end="1306">the idle task, which is automatically called if no other task is eligible</li><li data-start="1268" data-end="1306">the autotest task, responsible for executing all the kernel testing requests</li></ul><p>both applications are part of the kernel repository, so that there is no need for an integration project in autotesting mode.</p><h4>Cross ffile</h4><p>Cross-files are used in order to define the hardware target properties and how the cross-toolchains are deployed on your host. Because these files are used to declare how the development environment is set, they are not a part of the Sentry-kernel repository, but instead under your own control.</p><p>In order to help with this step, and also because they are used in the project CI jobs, there are multiple cross-files that matches the Sentry-kernel requirements in the camelot-os <a href="https://github.com/camelot-os/meson-cross-files">cross-files</a> repository, that you can use directly, or modify depending on your own environment configuration (toolchains paths and so on).</p><p>See <a href="https://mesonbuild.com/Cross-compilation.html">meson cross-compilation manual</a> for more information about cross-files.</p><h3 data-start="1235" data-end="1266">Set Up a Build Directory</h3><p>Now that all your input configuration data are clearly identified, you can setup the kernel build environment in autotest mode. A typical setup of Sentry kernel in autotest mode is then the following:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><pre class="language-bash"><code>defconfig configs/stm32f429i_disc1_autotest_defconfig
meson setup -Dconfig=.config -Ddts=dts/examples/stm32f429i_disc1_autotest.dts --cross-file=$HOME/my-cross-file.ini builddir</code></pre><p>The meson build system will verify that all the required tools and toolchains are properly configured and are able to execute the various build targets required.</p><p>At the end of the setup run, a global summary of your configuration is displayed:</p><pre class="language-bash"><code>  Targets
    sentry-kernel    : YES
    idle             : YES
    uapi             : YES
    autotest         : YES
    tools            : YES
    doc              : NO
    unit tests       : NO
    formal proof     : NO
    sbom             : NO

  Subprojects
    argparse         : YES
    cmsis            : YES
    devicetree       : YES
    kadoc            : YES
    kconfig          : YES
    nlohmann_json    : YES

  User defined options
    Cross files      : /home/user/.local/share/meson/cross/cm4-none-eabi-gcc.ini
    config           : .config
    dts              : dts/examples/stm32f429i_disc1_autotest.dts
    dts-include-dirs : dts
    with_sbom        : false
</code></pre></div></div><h2 data-start="1817" data-end="1842">Build the Kernel</h2><p data-start="1844" data-end="1889">Once Meson is configured, compile with Ninja:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><pre class="language-bash"><code>ninja -C builddir</code></pre></div></div><p data-start="1920" data-end="2042">This produces a firmware image (e.g., <code data-start="1958" data-end="1972">firmware.hex</code>) with autotest support baked in at the root of the build directory.</p><h2 data-start="2049" data-end="2099">Use Robot Framework for Automated Testing</h2><p data-start="2101" data-end="2300">Sentry’s autotest system is designed so that <strong data-start="2146" data-end="2199">Robot Framework can parse and report test results</strong>. The repository includes Robot test files under <code data-start="2248" data-end="2262">tools/robot/</code>.</p><p data-start="2101" data-end="2300">This framework is made in order to flash, start and dump the autotest results to validate all delivered results in a pretty-printed report. This report simplify the kernel test suite analysis and is made in order to allow CI-based report deliveries.</p><h3 data-start="2302" data-end="2347">Install Robot Framework &amp; Dependencies</h3><p data-start="2349" data-end="2431">Install Robot and protocols to talk to a target (for example via PyOCD or serial):</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><pre class="language-bash"><code>pip3 install robotframework robotframework-pyocd&gt;=0.2.0 robotframework-pyserial&gt;=1.2.0</code></pre></div></div><p data-start="2544" data-end="2694">These packages allow Robot to interface with hardware debuggers and serial ports used by microcontroller targets.</p><p data-start="2544" data-end="2694">The roboframework-pyocd is a package that has been made by the H2Lab Camelot-OS team in ordrer to enable the usage of pyocd tool with robotframework, in order to automate the action of flashing running and dumping the tests.</p><h2 data-start="2701" data-end="2728">Run Autotest tests and get report</h2><p data-start="2730" data-end="2828">You need to know what is the jtag probe identifier to help with the board identification for flashing. This information is easily accessible using pyocd using the list argument:</p><pre class="language-bash"><code>pyocd list
  #   Probe/Board       Unique ID                  Target            
---------------------------------------------------------------------
  0   STLINK-V3         004300483232510239353236   ✔︎ stm32u5a5zjtxq  
      NUCLEO-U5A5ZJ-Q </code></pre><p data-start="2730" data-end="2828">To execute the autotest suite with Robot Framework and generate logs and a structured report, run:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><pre class="language-bash"><code>robot \
  --variable FIRMWARE_FILE:builddir/firmware.hex \
 --variable PROBE_UID:YOUR_PROBE_ID \
 -d results \
tools/robot/sentry-autotest.robot</code></pre></div></div><ul data-start="2990" data-end="3248"><li data-start="2990" data-end="3043"><p data-start="2992" data-end="3043"><code data-start="2992" data-end="3007">FIRMWARE_FILE</code> points to your compiled firmware.</p></li><li data-start="3044" data-end="3135"><p data-start="3046" data-end="3135"><code data-start="3046" data-end="3057">PROBE_UID</code> is the ID of your debug probe (e.g., ST-Link) from tools like <code data-start="3120" data-end="3132">pyocd list</code>.</p></li><li data-start="3136" data-end="3248"><p data-start="3138" data-end="3248"><code data-start="3138" data-end="3150">-d results</code> outputs the test logs and report to the <code data-start="3191" data-end="3200">results</code> directory.</p></li></ul><p data-start="3250" data-end="3296">After the tests run, Robot Framework produces:</p><ul data-start="3298" data-end="3465"><li data-start="3298" data-end="3344"><p data-start="3300" data-end="3344"><code data-start="3300" data-end="3313">report.html</code> – an interactive HTML report</p></li><li data-start="3345" data-end="3385"><p data-start="3347" data-end="3385"><code data-start="3347" data-end="3357">log.html</code> – detailed execution logs</p></li><li data-start="3386" data-end="3465"><p data-start="3388" data-end="3465"><code data-start="3388" data-end="3400">output.xml</code> – structured results useful for CI pipelines or further analysis</p></li></ul><p><strong>Caution</strong>: Be sure that no pyocd instance neither attached gdb or terminal is active when calling robotframework, as concurrent access to a JTAG probe is forbidden.</p><h2 data-start="3472" data-end="3505">Interpreting the Results</h2><p data-start="3507" data-end="3555">Robot Framework’s report and log files document:</p><ul data-start="3557" data-end="3686"><li data-start="3557" data-end="3589"><p data-start="3559" data-end="3589">Which tests passed or failed</p></li><li data-start="3590" data-end="3661"><p data-start="3592" data-end="3661">Timing, hardware interactions, and any error output from the target</p></li><li data-start="3662" data-end="3686"><p data-start="3664" data-end="3686">Links to captured logs</p></li></ul><p data-start="3688" data-end="3778">You can open <code data-start="3701" data-end="3714">report.html</code> in a browser to get a digestible summary of all executed cases.</p></div></article></main><footer class="footer"><div class="wrapper"><div class="footer__copyright"><p>A H2Lab project</p></div><button id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://camelot-os.h2lab.org/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://camelot-os.h2lab.org/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script><script>(function() {
					let collapsibleTOCItems = document.querySelectorAll(".post__toc h2");

					collapsibleTOCItems.forEach(function(item, index) {
						let subList = item.nextElementSibling;
						let parentItem = item.parentElement;
						let toggleButton = null;

						if (subList && subList.tagName === "OL") {
						let defaultState = 'false';
						parentItem.setAttribute('aria-expanded', defaultState);
						subList.setAttribute('aria-hidden', defaultState === 'true' ? 'false' : 'true');

						// Assign ID to subList
						subList.setAttribute('id', 'sublist-' + index);

						const toggleElement = "both";

						if (toggleElement === "header" || toggleElement === "both") {
							// Assign aria-controls and tabindex to item (header)
							item.setAttribute('aria-controls', 'sublist-' + index);
							item.setAttribute('tabindex', '0');

							item.addEventListener('click', function(event) {
								event.preventDefault();
								toggleSubList(this, toggleButton);
							});

							item.addEventListener('keydown', function(event) {
								if (event.key === 'Enter' || event.key === ' ') {
								event.preventDefault();
								toggleSubList(this, toggleButton);
								}
							});
						}

						if (toggleElement === "button" || toggleElement === "both") {
							toggleButton = item.querySelector('.post__toc-toggle');
							if (toggleButton) {
								// Assign aria-controls and tabindex to toggleButton
								toggleButton.setAttribute('aria-controls', 'sublist-' + index);
								toggleButton.setAttribute('tabindex', '0');
								toggleButton.textContent = defaultState === 'true' ? 'hide' : 'show';
								toggleButton.addEventListener('click', function(event) {
								event.stopPropagation();
								event.preventDefault();
								toggleSubList(item, toggleButton);
								});
							}
						}
						}
					});

					function toggleSubList(element, button) {
						let parentItem = element.parentElement;
						let subList = parentItem.querySelector('ol');

						if (subList) {
						if (parentItem.getAttribute('aria-expanded') === 'true') {
							parentItem.setAttribute('aria-expanded', 'false');
							subList.setAttribute('aria-hidden', 'true');
						} else {
							parentItem.setAttribute('aria-expanded', 'true');
							subList.setAttribute('aria-hidden', 'false');
						}
						}

						if (button) {
						button.textContent = parentItem.getAttribute('aria-expanded') === 'true' ? 'hide' : 'show';
						}
					}
				})();</script></body></html>