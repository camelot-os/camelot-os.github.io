<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Bootstrap a Rust application - Camelot Operating System</title><meta name="description" content="Using shield::shield_main!() for Bare-Metal / Sentry Targets When building Rust applications for Camelot OS / Sentry, you are not running on a traditional operating system like Linux or macOS. Instead, your program runs directly on top of the Sentry kernel, without a standard C runtime&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="stylesheet" href="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-beige.css"><link rel="stylesheet" href="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://camelot-os.h2lab.org/bootstrap-a-rust-application.html"><link rel="alternate" type="application/atom+xml" href="https://camelot-os.h2lab.org/feed.xml" title="Camelot Operating System - RSS"><link rel="alternate" type="application/json" href="https://camelot-os.h2lab.org/feed.json" title="Camelot Operating System - JSON"><meta property="og:title" content="Bootstrap a Rust application"><meta property="og:image" content="https://camelot-os.h2lab.org/media/website/camelot-OS.png"><meta property="og:image:width" content="323"><meta property="og:image:height" content="342"><meta property="og:site_name" content="Camelot Operating System"><meta property="og:description" content="Using shield::shield_main!() for Bare-Metal / Sentry Targets When building Rust applications for Camelot OS / Sentry, you are not running on a traditional operating system like Linux or macOS. Instead, your program runs directly on top of the Sentry kernel, without a standard C runtime&hellip;"><meta property="og:url" content="https://camelot-os.h2lab.org/bootstrap-a-rust-application.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://camelot-os.h2lab.org/media/website/h2lab.png" type="image/png"><link rel="stylesheet" href="https://camelot-os.h2lab.org/assets/css/style.css?v=1d12dfc293a797122c81fcead8a9b6ac"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://camelot-os.h2lab.org/bootstrap-a-rust-application.html"},"headline":"Bootstrap a Rust application","datePublished":"2026-01-18T09:14+01:00","dateModified":"2026-01-18T09:14+01:00","image":{"@type":"ImageObject","url":"https://camelot-os.h2lab.org/media/website/camelot-OS.png","height":342,"width":323},"description":"Using shield::shield_main!() for Bare-Metal / Sentry Targets When building Rust applications for Camelot OS / Sentry, you are not running on a traditional operating system like Linux or macOS. Instead, your program runs directly on top of the Sentry kernel, without a standard C runtime&hellip;","author":{"@type":"Person","name":"H2Lab Development Team","url":"https://camelot-os.h2lab.org/authors/h2lab-development-team/"},"publisher":{"@type":"Organization","name":"H2Lab Development Team","logo":{"@type":"ImageObject","url":"https://camelot-os.h2lab.org/media/website/camelot-OS.png","height":342,"width":323}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.ti{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style></head><body class="page-template"><header class="top js-header"><a class="logo" href="https://camelot-os.h2lab.org/"><img src="https://camelot-os.h2lab.org/media/website/camelot-OS.png" alt="Camelot Operating System" width="323" height="342"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Pages</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://camelot-os.h2lab.org/camelot-os-because-secure-systems-deserve-a-secure-foundation.html" target="_self">Introduction</a></li><li><a href="https://camelot-os.h2lab.org/sentry-micro-kernel.html" target="_self">Sentry micro-kernel</a></li><li><a href="https://camelot-os.h2lab.org/camelot-os-sdk.html" target="_self">Camelot SDK</a></li></ul></li><li><a href="https://camelot-os.h2lab.org/" target="_self">Blog Posts</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Documentation</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://sentry-kernel.readthedocs.io/en/latest/" target="_blank">Sentry kernel</a></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Howtos</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active"><a href="https://camelot-os.h2lab.org/bootstrap-a-rust-application.html" target="_self">Bootsrap a Rust application</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Repositories</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://github.com/camelot-os/sentry-kernel" target="_blank">Sentry Kernel</a></li><li><a href="https://github.com/camelot-os/shield" target="_self">Shield runtime</a></li><li><a href="https://github.com/camelot-os/shield" target="_self">Barbican project manager</a></li></ul></li></ul></nav></header><main class="page"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>Bootstrap a Rust application</h1></div></header></div><div class="entry-wrapper content__entry"><h2 data-start="244" data-end="313">Using <code data-start="257" data-end="281">shield::shield_main!()</code> for Bare-Metal / Sentry Targets</h2><p data-start="315" data-end="564">When building Rust applications for <strong data-start="351" data-end="374">Camelot OS / Sentry</strong>, you are <em data-start="384" data-end="389">not</em> running on a traditional operating system like Linux or macOS. Instead, your program runs <strong data-start="480" data-end="520">directly on top of the Sentry kernel</strong>, without a standard C runtime or OS loader.</p><p data-start="566" data-end="620">This is where the following construct comes into play:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary">¬†</div><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><pre class="language-rust"><code>#[cfg(target_os = "none")] shield::shield_main!();</code></pre></div></div><p data-start="686" data-end="785">Let‚Äôs break down <strong data-start="703" data-end="721">what this does</strong>, <strong data-start="723" data-end="743">when you need it</strong>, and <strong data-start="749" data-end="784">how it works with <code data-start="769" data-end="782">sentry-uapi</code></strong>.</p><h2 data-start="792" data-end="823">üîç Why <code data-start="802" data-end="822">target_os = "none"</code>?</h2><p data-start="825" data-end="915">In Rust, the compilation target determines what runtime assumptions are made. For example:</p><div class="TyagGW_tableContainer"><div class="group TyagGW_tableWrapper flex flex-col-reverse w-fit" tabindex="-1"><table class="w-fit min-w-(--thread-content-width)" data-start="917" data-end="1072"><thead data-start="917" data-end="937"><tr data-start="917" data-end="937"><th data-start="917" data-end="926" data-col-size="sm">Target</th><th data-start="926" data-end="937" data-col-size="md">Meaning</th></tr></thead><tbody data-start="956" data-end="1072"><tr data-start="956" data-end="1022"><td data-start="956" data-end="975" data-col-size="sm"><code data-start="958" data-end="965">linux</code>, <code data-start="967" data-end="974">macos</code></td><td data-col-size="md" data-start="975" data-end="1022">Full OS with libc, process loader, syscalls</td></tr><tr data-start="1023" data-end="1072"><td data-start="1023" data-end="1032" data-col-size="sm"><code data-start="1025" data-end="1031">none</code></td><td data-col-size="md" data-start="1032" data-end="1072"><strong data-start="1034" data-end="1070">Bare-metal / no operating system</strong></td></tr></tbody></table></div></div><p data-start="1074" data-end="1116">Camelot OS applications are compiled with:</p><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs">¬†</div></div><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span class="hljs-attr">--target</span> &lt;arch&gt;-unknown-<span class="hljs-attribute">none</span></code></div></div><p data-start="1156" data-end="1172">This tells Rust:</p><ul data-start="1174" data-end="1282"><li data-start="1174" data-end="1185"><p data-start="1176" data-end="1185">‚ùå No libc</p></li><li data-start="1186" data-end="1218"><p data-start="1188" data-end="1218">‚ùå No default <code data-start="1201" data-end="1207">main</code> entrypoint</p></li><li data-start="1219" data-end="1241"><p data-start="1221" data-end="1241">‚ùå No OS startup code</p></li><li data-start="1242" data-end="1282"><p data-start="1244" data-end="1282">‚úÖ You must provide your own entrypoint</p></li></ul><p data-start="1284" data-end="1435">The <code data-start="1288" data-end="1316">#[cfg(target_os = "none")]</code> attribute ensures the code is <strong data-start="1347" data-end="1394">only compiled for bare-metal Sentry targets</strong>, and not for local development or tests.</p><h2 data-start="1442" data-end="1481">üß± What Is <code data-start="1456" data-end="1480">shield::shield_main!()</code>?</h2><p data-start="1483" data-end="1588"><code data-start="1483" data-end="1507">shield::shield_main!()</code> is a <strong data-start="1513" data-end="1533">procedural macro</strong> provided by the <em data-start="1550" data-end="1558">shield</em> runtime crate. Its job is to:</p><ol data-start="1590" data-end="1763"><li data-start="1590" data-end="1626"><p data-start="1593" data-end="1626"><strong data-start="1593" data-end="1626">Define the program entrypoint</strong></p></li><li data-start="1627" data-end="1666"><p data-start="1630" data-end="1666"><strong data-start="1630" data-end="1666">Set up the execution environment</strong></p></li><li data-start="1667" data-end="1716"><p data-start="1670" data-end="1716"><strong data-start="1670" data-end="1716">Connect Rust code to the Sentry kernel ABI</strong></p></li><li data-start="1717" data-end="1763"><p data-start="1720" data-end="1763"><strong data-start="1720" data-end="1763">Safely call your Rust <code data-start="1744" data-end="1752">main()</code> function</strong></p></li></ol><p data-start="1765" data-end="1869">In other words, it replaces what <code data-start="1798" data-end="1804">crt0</code>, the ELF loader, and libc would normally do on a traditional OS.</p><p data-start="1871" data-end="1938">Without this macro, your program <strong data-start="1904" data-end="1923">would not start</strong> on Camelot OS.</p><h2 data-start="1945" data-end="1985">‚öôÔ∏è What the Macro Does (Conceptually)</h2><p data-start="1987" data-end="2094">While the macro expands to target-specific assembly and Rust glue code, conceptually it does the following:</p><ol data-start="2096" data-end="2300"><li data-start="2096" data-end="2148"><p data-start="2099" data-end="2148">Defines a <code data-start="2109" data-end="2117">_start</code> symbol (the kernel entrypoint)</p></li><li data-start="2149" data-end="2183"><p data-start="2152" data-end="2183">Initializes stack and registers</p></li><li data-start="2184" data-end="2223"><p data-start="2187" data-end="2223">Sets up the Sentry syscall interface</p></li><li data-start="2224" data-end="2265"><p data-start="2227" data-end="2265">Jumps into your Rust <code data-start="2248" data-end="2256">main()</code> function</p></li><li data-start="2266" data-end="2300"><p data-start="2269" data-end="2300">Handles exit back to the kernel</p></li></ol><p data-start="2302" data-end="2444">This makes it possible for <strong data-start="2329" data-end="2355"><code data-start="2331" data-end="2344">sentry-uapi</code> syscalls</strong> to work correctly, because the kernel expects a well-defined ABI and calling convention.</p><h2 data-start="2451" data-end="2492">üß™ Typical Usage in a Camelot Rust App</h2><p data-start="2494" data-end="2563">A minimal <code data-start="2504" data-end="2513">main.rs</code> for a Sentry application usually looks like this:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary">¬†</div><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><pre class="language-rust"><code>#![no_std]
#![no_main]

use shield::prelude::*;

#[cfg(target_os = "none")]
shield::shield_main!();

fn main() {
    // Your application logic
}</code></pre></div></div><p data-start="2723" data-end="2734">Key points:</p><ul data-start="2736" data-end="2917"><li data-start="2736" data-end="2772"><p data-start="2738" data-end="2772"><code data-start="2738" data-end="2750">#![no_std]</code> ‚Üí no standard library</p></li><li data-start="2773" data-end="2821"><p data-start="2775" data-end="2821"><code data-start="2775" data-end="2788">#![no_main]</code> ‚Üí disable Rust‚Äôs default runtime</p></li><li data-start="2822" data-end="2873"><p data-start="2824" data-end="2873"><code data-start="2824" data-end="2840">shield_main!()</code> ‚Üí installs the Sentry entrypoint</p></li><li data-start="2874" data-end="2917"><p data-start="2876" data-end="2917"><code data-start="2876" data-end="2884">main()</code> ‚Üí still written like normal Rust</p></li></ul><p data-start="2919" data-end="2987">The macro <strong data-start="2929" data-end="2948">bridges the gap</strong> between the kernel and your Rust code.</p><h2 data-start="2994" data-end="3029">üîó Relationship to <code data-start="3016" data-end="3029">sentry-uapi</code></h2><p data-start="3031" data-end="3054"><code data-start="3031" data-end="3044">sentry-uapi</code> provides:</p><ul data-start="3055" data-end="3117"><li data-start="3055" data-end="3069"><p data-start="3057" data-end="3069">Raw syscalls</p></li><li data-start="3070" data-end="3091"><p data-start="3072" data-end="3091">Shared kernel types</p></li><li data-start="3092" data-end="3117"><p data-start="3094" data-end="3117">Exchange buffer helpers</p></li></ul><p data-start="3119" data-end="3138">But it <strong data-start="3126" data-end="3137">assumes</strong>:</p><ul data-start="3139" data-end="3266"><li data-start="3139" data-end="3166"><p data-start="3141" data-end="3166">A valid entrypoint exists</p></li><li data-start="3167" data-end="3210"><p data-start="3169" data-end="3210">The process ABI matches the Sentry kernel</p></li><li data-start="3211" data-end="3266"><p data-start="3213" data-end="3266">Syscall registers and stack are correctly initialized</p></li></ul><p data-start="3268" data-end="3335"><code data-start="3268" data-end="3292">shield::shield_main!()</code> ensures all of those assumptions are true.</p><p data-start="3337" data-end="3366">Think of the roles like this:</p><div class="TyagGW_tableContainer"><div class="group TyagGW_tableWrapper flex flex-col-reverse w-fit" tabindex="-1"><table class="w-fit min-w-(--thread-content-width)" data-start="3368" data-end="3542"><thead data-start="3368" data-end="3398"><tr data-start="3368" data-end="3398"><th data-start="3368" data-end="3380" data-col-size="sm">Component</th><th data-start="3380" data-end="3398" data-col-size="sm">Responsibility</th></tr></thead><tbody data-start="3427" data-end="3542"><tr data-start="3427" data-end="3471"><td data-start="3427" data-end="3446" data-col-size="sm"><code data-start="3429" data-end="3445">shield_main!()</code></td><td data-col-size="sm" data-start="3446" data-end="3471">Program startup &amp; ABI</td></tr><tr data-start="3472" data-end="3512"><td data-start="3472" data-end="3488" data-col-size="sm"><code data-start="3474" data-end="3487">sentry-uapi</code></td><td data-col-size="sm" data-start="3488" data-end="3512">Kernel communication</td></tr><tr data-start="3513" data-end="3542"><td data-start="3513" data-end="3524" data-col-size="sm">Your app</td><td data-col-size="sm" data-start="3524" data-end="3542">Business logic</td></tr></tbody></table></div></div><p data-start="3544" data-end="3579">They are designed to work together.</p><h2 data-start="3586" data-end="3623">üß† Why the <code data-start="3600" data-end="3605">cfg</code> Attribute Matters</h2><p data-start="3625" data-end="3631">Using:</p><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><pre class="language-rust"><code>#[cfg(target_os = "none")]
shield::shield_main!();
</code></pre></div><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2">¬†</div><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="overflow-y-auto p-4" dir="ltr"><span style="font-size: inherit;">lets you </span><strong style="font-size: inherit;" data-start="3706" data-end="3733">reuse the same codebase</strong><span style="font-size: inherit;"> for:</span></div></div><ul data-start="3740" data-end="3820"><li data-start="3740" data-end="3774"><p data-start="3742" data-end="3774">üñ•Ô∏è Local testing on Linux/macOS</p></li><li data-start="3775" data-end="3790"><p data-start="3777" data-end="3790">üß™ Unit tests</p></li><li data-start="3791" data-end="3820"><p data-start="3793" data-end="3820">üöÄ Deployment on Camelot OS</p></li></ul><p data-start="3822" data-end="3844">On non-Sentry targets:</p><ul data-start="3845" data-end="3916"><li data-start="3845" data-end="3876"><p data-start="3847" data-end="3876">The macro is <strong data-start="3860" data-end="3876">not compiled</strong></p></li><li data-start="3877" data-end="3916"><p data-start="3879" data-end="3916">You can still build and test normally</p></li></ul><p data-start="3918" data-end="3985">This pattern is strongly recommended for Sentry-based applications.</p><h2 data-start="3992" data-end="4021">‚úÖ Common Mistakes to Avoid</h2><p data-start="4023" data-end="4179">‚ùå Forgetting <code data-start="4036" data-end="4049">#![no_main]</code><br data-start="4049" data-end="4052">‚ùå Calling <code data-start="4062" data-end="4078">shield_main!()</code> unconditionally<br data-start="4094" data-end="4097">‚ùå Using <code data-start="4105" data-end="4110">std</code> on a <code data-start="4116" data-end="4122">none</code> target<br data-start="4129" data-end="4132">‚ùå Expecting <code data-start="4144" data-end="4152">main()</code> to be the ELF entrypoint</p><p data-start="4181" data-end="4291">If your app ‚Äúbuilds but never starts,‚Äù the missing or misconfigured <code data-start="4249" data-end="4265">shield_main!()</code> macro is often the cause.</p><h2 data-start="4298" data-end="4311">üèÅ Summary</h2><ul data-start="4313" data-end="4582"><li data-start="4313" data-end="4365"><p data-start="4315" data-end="4365"><code data-start="4315" data-end="4335">target_os = "none"</code> means <strong data-start="4342" data-end="4365">bare-metal / Sentry</strong></p></li><li data-start="4366" data-end="4428"><p data-start="4368" data-end="4428"><code data-start="4368" data-end="4392">shield::shield_main!()</code> provides the <strong data-start="4406" data-end="4428">program entrypoint</strong></p></li><li data-start="4429" data-end="4470"><p data-start="4431" data-end="4470">It replaces the OS loader and C runtime</p></li><li data-start="4471" data-end="4530"><p data-start="4473" data-end="4530">It is <strong data-start="4479" data-end="4491">required</strong> for <code data-start="4496" data-end="4509">sentry-uapi</code> syscalls to function</p></li><li data-start="4531" data-end="4582"><p data-start="4533" data-end="4582">The <code data-start="4537" data-end="4542">cfg</code> guard allows cross-platform development</p></li></ul><p data-start="4584" data-end="4691">This macro is the <strong data-start="4602" data-end="4616">foundation</strong> that allows Rust applications to run safely and predictably on Camelot OS.</p></div></article></main><footer class="footer"><div class="wrapper"><div class="footer__copyright"><p>A H2Lab project</p></div><button id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://camelot-os.h2lab.org/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://camelot-os.h2lab.org/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://camelot-os.h2lab.org/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script></body></html>